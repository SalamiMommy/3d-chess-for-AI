2025-11-29 14:28:45,998 - __main__ - INFO - [SEARCH] Validating game system integrity...
2025-11-29 14:28:45,998 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 14:28:45,999 - __main__ - INFO - Testing move generation...
2025-11-29 14:28:46,326 - __main__ - INFO - [OK] Generated 624 moves
2025-11-29 14:28:46,326 - __main__ - INFO - Testing GameState caching...
2025-11-29 14:28:46,326 - __main__ - INFO - [OK] GameState caching works
2025-11-29 14:28:46,326 - __main__ - INFO - Testing MoveCache persistence...
2025-11-29 14:28:46,327 - __main__ - INFO - [OK] MoveCache works correctly
2025-11-29 14:28:46,327 - __main__ - INFO - Final cache stats: {'legal_hit_rate': np.float64(0.6666666666666666), 'pseudolegal_hit_rate': np.float64(0.0), 'raw_hit_rate': np.float64(0.0), 'piece_hit_rate': np.float64(0.0), 'total_moves_cached': np.int32(624), 'piece_moves_cache_size': 27, 'prune_operations': 0, 'cache_hits': np.int32(2), 'cache_misses': np.int32(1)}
2025-11-29 14:28:47,730 - __main__ - INFO - Saved temporary checkpoint: model_checkpoints/train_huge_20251129_142842/temp_model_for_selfplay.pt
2025-11-29 14:28:47,730 - training.parallel_self_play - INFO - Starting Client-Server Self-Play: 12 games, 6 workers
2025-11-29 14:28:50,527 - training.parallel_self_play - INFO - Launching workers...
2025-11-29 14:28:58,624 - InferenceServer - INFO - Starting Server on cuda (Batch Size: 6)
2025-11-29 14:29:02,293 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 14:29:02,295 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 139955453186192
2025-11-29 14:29:02,556 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 14:29:02,558 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 140105834745856
2025-11-29 14:29:02,607 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 14:29:02,608 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 140116137989008
2025-11-29 14:29:02,668 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 14:29:02,669 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 140147968119504
2025-11-29 14:29:02,948 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 14:29:02,949 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 140419288666784
2025-11-29 14:29:03,052 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 14:29:03,053 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 140692554420944
2025-11-29 14:29:03,774 - InferenceServer - INFO - Detected compiled model (OptimizedModule). Loading weights into underlying _orig_mod.
2025-11-29 14:29:03,778 - InferenceServer - INFO - Model already compiled (or compilation unavailable), skipping re-compile.
2025-11-29 14:29:03,778 - InferenceServer - INFO - Server Ready. Listening...
2025-11-29 14:29:19,047 - game3d.cache.caches.movecache - INFO - Checkmate detected for WHITE (Priests: 0)
2025-11-29 14:29:19,064 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: BLACK)
2025-11-29 14:29:19,064 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 14:29:19,064 - game3d.game.terminal - WARNING -   - Black: Priests=2, King=(4,4,8)
2025-11-29 14:29:19,064 - game3d.game.terminal - WARNING -   - Attackers: VECTORSLIDER at (3,2,1), VECTORSLIDER at (3,6,1)
2025-11-29 14:29:19,076 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: BLACK)
2025-11-29 14:29:19,076 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 14:29:19,076 - game3d.game.terminal - WARNING -   - Black: Priests=2, King=(4,4,8)
2025-11-29 14:29:19,076 - game3d.game.terminal - WARNING -   - Attackers: VECTORSLIDER at (3,2,1), VECTORSLIDER at (3,6,1)
2025-11-29 14:29:19,096 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: BLACK)
2025-11-29 14:29:19,096 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 14:29:19,096 - game3d.game.terminal - WARNING -   - Black: Priests=2, King=(4,4,8)
2025-11-29 14:29:19,096 - game3d.game.terminal - WARNING -   - Attackers: VECTORSLIDER at (3,2,1), VECTORSLIDER at (3,6,1)
2025-11-29 14:29:19,108 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: BLACK)
2025-11-29 14:29:19,109 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 14:29:19,109 - game3d.game.terminal - WARNING -   - Black: Priests=2, King=(4,4,8)
2025-11-29 14:29:19,109 - game3d.game.terminal - WARNING -   - Attackers: VECTORSLIDER at (3,2,1), VECTORSLIDER at (3,6,1)
2025-11-29 14:29:19,127 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: BLACK)
2025-11-29 14:29:19,127 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 14:29:19,127 - game3d.game.terminal - WARNING -   - Black: Priests=2, King=(4,4,8)
2025-11-29 14:29:19,127 - game3d.game.terminal - WARNING -   - Attackers: VECTORSLIDER at (3,2,1), VECTORSLIDER at (3,6,1)
2025-11-29 14:29:19,142 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 14:29:19,142 - game3d.cache.manager - DEBUG - Created cache manager #2 for board 140105810440304
2025-11-29 14:29:23,188 - game3d.game.turnmove - INFO - Move 100: WHITE BOMB [0 5 1]->[1 5 2] (Move)
2025-11-29 14:29:23,369 - game3d.game.turnmove - INFO - Move 100: BLACK INFILTRATOR [2 4 5]->[3 5 6] (Capture)
2025-11-29 14:29:25,828 - game3d.game.turnmove - INFO - Move 100: BLACK PANEL [2 6 8]->[2 6 2] (Capture)
2025-11-29 14:29:29,152 - game3d.game.turnmove - INFO - Move 100: WHITE YZQUEEN [3 6 1]->[3 6 6] (Capture)
2025-11-29 14:29:33,860 - game3d.game.turnmove - INFO - Move 200: WHITE KNIGHT32 [5 3 0]->[3 1 3] (Capture)
2025-11-29 14:29:35,175 - game3d.game.turnmove - INFO - Move 200: WHITE ROOK [5 5 8]->[4 5 8] (Capture)
2025-11-29 14:29:40,182 - game3d.game.turnmove - INFO - Move 100: WHITE ECHO [0 8 6]->[1 7 5] (Capture)
2025-11-29 14:29:50,485 - game3d.cache.caches.movecache - INFO - Checkmate detected for BLACK (Priests: 0)
2025-11-29 14:29:50,505 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:29:50,505 - game3d.game.terminal - WARNING -   - White: Priests=2, King=(4,4,0)
2025-11-29 14:29:50,505 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,3,7)
2025-11-29 14:29:50,505 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,3,6)
2025-11-29 14:29:50,523 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:29:50,523 - game3d.game.terminal - WARNING -   - White: Priests=2, King=(4,4,0)
2025-11-29 14:29:50,523 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,3,7)
2025-11-29 14:29:50,523 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,3,6)
2025-11-29 14:29:50,546 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:29:50,546 - game3d.game.terminal - WARNING -   - White: Priests=2, King=(4,4,0)
2025-11-29 14:29:50,546 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,3,7)
2025-11-29 14:29:50,546 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,3,6)
2025-11-29 14:29:50,563 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:29:50,564 - game3d.game.terminal - WARNING -   - White: Priests=2, King=(4,4,0)
2025-11-29 14:29:50,564 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,3,7)
2025-11-29 14:29:50,564 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,3,6)
2025-11-29 14:29:50,592 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:29:50,592 - game3d.game.terminal - WARNING -   - White: Priests=2, King=(4,4,0)
2025-11-29 14:29:50,592 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,3,7)
2025-11-29 14:29:50,592 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,3,6)
2025-11-29 14:29:50,690 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 14:29:50,690 - game3d.cache.manager - DEBUG - Created cache manager #2 for board 140419280666480
2025-11-29 14:29:54,830 - game3d.game.turnmove - INFO - Move 100: BLACK XYQUEEN [4 5 7]->[3 4 8] (Capture)
2025-11-29 14:29:57,615 - game3d.game.turnmove - INFO - Move 300: BLACK SPEEDER [0 7 7]->[2 7 5] (Move)
2025-11-29 14:29:58,522 - game3d.game.turnmove - INFO - Move 200: BLACK PANEL [4 4 2]->[4 4 1] (Capture)
2025-11-29 14:30:12,158 - game3d.cache.caches.movecache - INFO - Checkmate detected for WHITE (Priests: 0)
2025-11-29 14:30:12,175 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: BLACK)
2025-11-29 14:30:12,175 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 14:30:12,176 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(5,4,8)
2025-11-29 14:30:12,176 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,1)
2025-11-29 14:30:12,191 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: BLACK)
2025-11-29 14:30:12,191 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 14:30:12,191 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(5,4,8)
2025-11-29 14:30:12,191 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,1)
2025-11-29 14:30:12,215 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: BLACK)
2025-11-29 14:30:12,215 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 14:30:12,215 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(5,4,8)
2025-11-29 14:30:12,215 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,1)
2025-11-29 14:30:12,235 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: BLACK)
2025-11-29 14:30:12,235 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 14:30:12,235 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(5,4,8)
2025-11-29 14:30:12,235 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,1)
2025-11-29 14:30:12,254 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: BLACK)
2025-11-29 14:30:12,254 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 14:30:12,254 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(5,4,8)
2025-11-29 14:30:12,254 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,1)
2025-11-29 14:30:12,398 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 14:30:12,398 - game3d.cache.manager - DEBUG - Created cache manager #2 for board 140688130918048
2025-11-29 14:30:17,482 - game3d.game.turnmove - INFO - Move 100: BLACK FREEZER [0 8 7]->[0 7 7] (Capture)
2025-11-29 14:30:21,839 - game3d.game.turnmove - INFO - Move 200: BLACK ECHO [4 7 1]->[5 6 2] (Capture)
2025-11-29 14:30:23,265 - game3d.game.turnmove - INFO - Move 100: WHITE XYQUEEN [5 4 1]->[4 4 1] (Capture)
2025-11-29 14:30:34,077 - game3d.game.turnmove - INFO - Move 300: BLACK INFILTRATOR [5 2 1]->[5 3 0] (Move)
2025-11-29 14:30:37,079 - game3d.game.turnmove - INFO - Move 400: BLACK YZQUEEN [3 2 8]->[3 2 2] (Capture)
2025-11-29 14:30:46,891 - game3d.cache.caches.movecache - INFO - Checkmate detected for BLACK (Priests: 0)
2025-11-29 14:30:47,210 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:30:47,210 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(5,4,0)
2025-11-29 14:30:47,210 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:30:47,210 - game3d.game.terminal - WARNING -   - Attackers: QUEEN at (4,3,8)
2025-11-29 14:30:47,231 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:30:47,231 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(5,4,0)
2025-11-29 14:30:47,231 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:30:47,231 - game3d.game.terminal - WARNING -   - Attackers: QUEEN at (4,3,8)
2025-11-29 14:30:47,264 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:30:47,264 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(5,4,0)
2025-11-29 14:30:47,264 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:30:47,265 - game3d.game.terminal - WARNING -   - Attackers: QUEEN at (4,3,8)
2025-11-29 14:30:47,290 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:30:47,290 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(5,4,0)
2025-11-29 14:30:47,290 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:30:47,290 - game3d.game.terminal - WARNING -   - Attackers: QUEEN at (4,3,8)
2025-11-29 14:30:47,315 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:30:47,316 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(5,4,0)
2025-11-29 14:30:47,316 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:30:47,316 - game3d.game.terminal - WARNING -   - Attackers: QUEEN at (4,3,8)
2025-11-29 14:30:47,527 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 14:30:47,527 - game3d.cache.manager - DEBUG - Created cache manager #3 for board 140688130919200
2025-11-29 14:30:52,466 - game3d.game.turnmove - INFO - Move 100: WHITE ROOK [3 5 2]->[3 5 6] (Capture)
2025-11-29 14:31:15,089 - game3d.cache.caches.movecache - INFO - Checkmate detected for BLACK (Priests: 0)
2025-11-29 14:31:15,110 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:31:15,110 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 14:31:15,110 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:31:15,110 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,7)
2025-11-29 14:31:15,131 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:31:15,131 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 14:31:15,131 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:31:15,131 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,7)
2025-11-29 14:31:15,160 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:31:15,160 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 14:31:15,160 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:31:15,160 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,7)
2025-11-29 14:31:15,178 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:31:15,178 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 14:31:15,178 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:31:15,178 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,7)
2025-11-29 14:31:15,200 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:31:15,200 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 14:31:15,201 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:31:15,201 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,7)
2025-11-29 14:31:15,330 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 14:31:15,330 - game3d.cache.manager - DEBUG - Created cache manager #4 for board 140688131497104
2025-11-29 14:31:16,499 - game3d.game.turnmove - INFO - Move 500: BLACK YZZIGZAG [0 2 8]->[0 2 6] (Capture)
2025-11-29 14:31:20,068 - game3d.game.turnmove - INFO - Move 100: WHITE KNIGHT [2 4 1]->[1 4 3] (Move)
2025-11-29 14:31:21,066 - game3d.cache.caches.movecache - INFO - Checkmate detected for BLACK (Priests: 0)
2025-11-29 14:31:21,084 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:31:21,084 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(5,4,1)
2025-11-29 14:31:21,084 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:31:21,085 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,7)
2025-11-29 14:31:21,104 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:31:21,104 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(5,4,1)
2025-11-29 14:31:21,104 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:31:21,104 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,7)
2025-11-29 14:31:21,128 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:31:21,128 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(5,4,1)
2025-11-29 14:31:21,128 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:31:21,128 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,7)
2025-11-29 14:31:21,147 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:31:21,148 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(5,4,1)
2025-11-29 14:31:21,148 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:31:21,148 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,7)
2025-11-29 14:31:21,179 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:31:21,179 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(5,4,1)
2025-11-29 14:31:21,179 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:31:21,179 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,7)
2025-11-29 14:31:21,331 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 14:31:21,332 - game3d.cache.manager - DEBUG - Created cache manager #2 for board 139955431148224
2025-11-29 14:31:27,978 - game3d.game.turnmove - INFO - Move 600: BLACK YZZIGZAG [8 2 6]->[8 2 4] (Capture)
2025-11-29 14:31:35,740 - game3d.game.turnmove - INFO - Move 200: WHITE ROOK [5 3 1]->[5 3 6] (Capture)
2025-11-29 14:31:43,351 - game3d.game.turnmove - INFO - Move 200: BLACK SPIRAL [5 4 2]->[5 4 0] (Capture)
2025-11-29 14:31:46,206 - game3d.game.turnmove - INFO - Move 100: BLACK ARMOUR [5 7 7]->[4 7 7] (Move)
2025-11-29 14:31:58,017 - game3d.game.turnmove - INFO - Move 200: WHITE GEOMANCER [4 3 3]->[7 2 4] (Move)
2025-11-29 14:32:05,861 - game3d.game.turnmove - INFO - Move 200: WHITE PAWN [2 2 2]->[3 3 3] (Capture)
2025-11-29 14:32:35,695 - game3d.cache.caches.movecache - INFO - Checkmate detected for BLACK (Priests: 0)
2025-11-29 14:32:35,715 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:32:35,715 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,5,1)
2025-11-29 14:32:35,715 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:32:35,715 - game3d.game.terminal - WARNING -   - Attackers: ROOK at (4,4,7)
2025-11-29 14:32:35,731 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:32:35,731 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,5,1)
2025-11-29 14:32:35,731 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:32:35,731 - game3d.game.terminal - WARNING -   - Attackers: ROOK at (4,4,7)
2025-11-29 14:32:35,753 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:32:35,753 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,5,1)
2025-11-29 14:32:35,753 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:32:35,753 - game3d.game.terminal - WARNING -   - Attackers: ROOK at (4,4,7)
2025-11-29 14:32:35,772 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:32:35,772 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,5,1)
2025-11-29 14:32:35,772 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:32:35,772 - game3d.game.terminal - WARNING -   - Attackers: ROOK at (4,4,7)
2025-11-29 14:32:35,796 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 14:32:35,796 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,5,1)
2025-11-29 14:32:35,796 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,4,8)
2025-11-29 14:32:35,796 - game3d.game.terminal - WARNING -   - Attackers: ROOK at (4,4,7)
2025-11-29 14:32:38,483 - game3d.cache.caches.movecache - INFO - Checkmate detected for BLACK (Priests: 0)
2025-11-29 14:32:45,343 - game3d.game.turnmove - INFO - Move 700: BLACK PANEL [2 5 7]->[2 5 8] (Move)
2025-11-29 14:32:45,837 - training.parallel_self_play - INFO - Stopping Server...
2025-11-29 14:32:45,837 - game3d.game3d - CRITICAL - ðŸš¨ MOVE EXECUTION FAILED: CPUDispatcher(<function _vectorized_batch_attributes at 0x7f76bd5c7e20>) returned a result with an exception set
Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 170, in _process_piece_type
    raw_moves = dispatcher(state, coord, ignore_occupancy=ignore_occupancy)
TypeError: wall_move_dispatcher() got an unexpected keyword argument 'ignore_occupancy'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3dgame/venv/lib/python3.13/site-packages/numba/core/serialize.py", line 30, in _numba_unpickle
    def _numba_unpickle(address, bytedata, hashed):
    
KeyboardInterrupt

The above exception was the direct cause of the following exception:

SystemError: <function _numba_unpickle at 0x7f76bdade160> returned a result with an exception set

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game3d.py", line 95, in submit_move
    new_state = turnmove.make_move(self._state, move_array)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game/turnmove.py", line 341, in make_move
    gen_module._generator.update_legal_moves_incremental(game_state)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 485, in update_legal_moves_incremental
    all_moves = self._apply_all_filters(state, all_moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 358, in _apply_all_filters
    moves = filter_safe_moves_optimized(state, moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 140, in filter_safe_moves_optimized
    if move_would_leave_king_in_check(game_state, moves[i]):
       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 105, in move_would_leave_king_in_check
    is_check = square_attacked_by_incremental(
        game_state.board,
    ...<4 lines>...
        to_coord
    )
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 305, in square_attacked_by_incremental
    return _square_attacked_by_slow(board, square, attacker_color, cache)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 358, in _square_attacked_by_slow
    moves = generate_pseudolegal_moves_batch(dummy_state, attacker_positions)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 312, in generate_pseudolegal_moves_batch
    piece_moves = _process_piece_type(state, piece_type, indices, batch_coords,
                                     dispatcher, ignore_occupancy)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 173, in _process_piece_type
    raw_moves = dispatcher(state, coord)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/wall.py", line 299, in wall_move_dispatcher
    return generate_wall_moves(state.cache_manager, state.color, pos)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/wall.py", line 288, in generate_wall_moves
    colors, types = cache_manager.occupancy_cache.batch_get_attributes(flat_targets)
                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/cache/caches/occupancycache.py", line 271, in batch_get_attributes
    return _vectorized_batch_attributes(self._occ, self._ptype, coords)
SystemError: CPUDispatcher(<function _vectorized_batch_attributes at 0x7f76bd5c7e20>) returned a result with an exception set
2025-11-29 14:32:45,837 - worker.1 - ERROR - Worker 1 failed: CPUDispatcher(<function _vectorized_batch_attributes_unsafe_parallel at 0x7f49ecde4400>) returned a result with an exception set
Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3dgame/venv/lib/python3.13/site-packages/numba/core/serialize.py", line 30, in _numba_unpickle
    def _numba_unpickle(address, bytedata, hashed):
    
KeyboardInterrupt

The above exception was the direct cause of the following exception:

SystemError: <function _numba_unpickle at 0x7f49ed2e2160> returned a result with an exception set

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/training/parallel_self_play.py", line 300, in _game_worker_client
    receipt = game.submit_move(submit_move)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game3d.py", line 113, in submit_move
    is_game_over=_terminal_is_game_over(new_state),
                 ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "/usr/lib/python3.13/contextlib.py", line 85, in inner
    return func(*args, **kwds)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game/terminal.py", line 230, in is_game_over
    legal_moves = game_state.legal_moves
                  ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game/gamestate.py", line 231, in legal_moves
    return turnmove.legal_moves(self)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game/turnmove.py", line 54, in legal_moves
    structured_moves = generate_legal_moves(game_state)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 528, in generate_legal_moves
    return _generator.generate(state)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 161, in generate
    return self.generate_fused(state)
           ~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 256, in generate_fused
    final_moves = self._apply_all_filters(state, final_moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 358, in _apply_all_filters
    moves = filter_safe_moves_optimized(state, moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 97, in filter_safe_moves_optimized
    if move_would_leave_king_in_check(game_state, moves[i]):
       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 105, in move_would_leave_king_in_check
    is_check = square_attacked_by_incremental(
        game_state.board,
    ...<4 lines>...
        to_coord
    )
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 305, in square_attacked_by_incremental
    return _square_attacked_by_slow(board, square, attacker_color, cache)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 358, in _square_attacked_by_slow
    moves = generate_pseudolegal_moves_batch(dummy_state, attacker_positions)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 232, in generate_pseudolegal_moves_batch
    colors_batch, types_batch = state.cache_manager.occupancy_cache.batch_get_attributes_unsafe(batch_coords)
                                ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/cache/caches/occupancycache.py", line 330, in batch_get_attributes_unsafe
    return _vectorized_batch_attributes_unsafe_parallel(self._occ, self._ptype, coords)
SystemError: CPUDispatcher(<function _vectorized_batch_attributes_unsafe_parallel at 0x7f49ecde4400>) returned a result with an exception set
2025-11-29 14:32:45,839 - worker.4 - ERROR - Worker 4 failed: Move execution failed: CPUDispatcher(<function _vectorized_batch_attributes at 0x7f76bd5c7e20>) returned a result with an exception set
Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 170, in _process_piece_type
    raw_moves = dispatcher(state, coord, ignore_occupancy=ignore_occupancy)
TypeError: wall_move_dispatcher() got an unexpected keyword argument 'ignore_occupancy'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3dgame/venv/lib/python3.13/site-packages/numba/core/serialize.py", line 30, in _numba_unpickle
    def _numba_unpickle(address, bytedata, hashed):
    
KeyboardInterrupt

The above exception was the direct cause of the following exception:

SystemError: <function _numba_unpickle at 0x7f76bdade160> returned a result with an exception set

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game3d.py", line 95, in submit_move
    new_state = turnmove.make_move(self._state, move_array)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game/turnmove.py", line 341, in make_move
    gen_module._generator.update_legal_moves_incremental(game_state)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 485, in update_legal_moves_incremental
    all_moves = self._apply_all_filters(state, all_moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 358, in _apply_all_filters
    moves = filter_safe_moves_optimized(state, moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 140, in filter_safe_moves_optimized
    if move_would_leave_king_in_check(game_state, moves[i]):
       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 105, in move_would_leave_king_in_check
    is_check = square_attacked_by_incremental(
        game_state.board,
    ...<4 lines>...
        to_coord
    )
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 305, in square_attacked_by_incremental
    return _square_attacked_by_slow(board, square, attacker_color, cache)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 358, in _square_attacked_by_slow
    moves = generate_pseudolegal_moves_batch(dummy_state, attacker_positions)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 312, in generate_pseudolegal_moves_batch
    piece_moves = _process_piece_type(state, piece_type, indices, batch_coords,
                                     dispatcher, ignore_occupancy)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 173, in _process_piece_type
    raw_moves = dispatcher(state, coord)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/wall.py", line 299, in wall_move_dispatcher
    return generate_wall_moves(state.cache_manager, state.color, pos)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/wall.py", line 288, in generate_wall_moves
    colors, types = cache_manager.occupancy_cache.batch_get_attributes(flat_targets)
                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/cache/caches/occupancycache.py", line 271, in batch_get_attributes
    return _vectorized_batch_attributes(self._occ, self._ptype, coords)
SystemError: CPUDispatcher(<function _vectorized_batch_attributes at 0x7f76bd5c7e20>) returned a result with an exception set

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/training/parallel_self_play.py", line 300, in _game_worker_client
    receipt = game.submit_move(submit_move)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game3d.py", line 98, in submit_move
    raise InvalidMoveError(f"Move execution failed: {e}") from e
game3d.game3d.InvalidMoveError: Move execution failed: CPUDispatcher(<function _vectorized_batch_attributes at 0x7f76bd5c7e20>) returned a result with an exception set
2025-11-29 14:32:45,841 - InferenceServer - INFO - Server shutting down.
2025-11-29 14:32:46,156 - __main__ - INFO - Training interrupted by user
2025-11-29 14:32:46,419 - __main__ - INFO - ðŸ§¹ Clearing all caches...
2025-11-29 15:00:19,059 - __main__ - INFO - [SEARCH] Validating game system integrity...
2025-11-29 15:00:19,060 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:00:19,063 - __main__ - INFO - Testing move generation...
2025-11-29 15:00:27,941 - __main__ - INFO - [OK] Generated 628 moves
2025-11-29 15:00:27,941 - __main__ - INFO - Testing GameState caching...
2025-11-29 15:00:27,942 - __main__ - INFO - [OK] GameState caching works
2025-11-29 15:00:27,942 - __main__ - INFO - Testing MoveCache persistence...
2025-11-29 15:00:27,942 - __main__ - INFO - [OK] MoveCache works correctly
2025-11-29 15:00:27,942 - __main__ - INFO - Final cache stats: {'legal_hit_rate': np.float64(0.6666666666666666), 'pseudolegal_hit_rate': np.float64(0.0), 'raw_hit_rate': np.float64(0.0), 'piece_hit_rate': np.float64(0.0), 'total_moves_cached': np.int32(628), 'piece_moves_cache_size': 31, 'prune_operations': 0, 'cache_hits': np.int32(2), 'cache_misses': np.int32(1)}
2025-11-29 15:00:29,505 - __main__ - INFO - Saved temporary checkpoint: model_checkpoints/train_huge_20251129_150014/temp_model_for_selfplay.pt
2025-11-29 15:00:29,505 - training.parallel_self_play - INFO - Starting Client-Server Self-Play: 12 games, 6 workers
2025-11-29 15:00:32,385 - training.parallel_self_play - INFO - Launching workers...
2025-11-29 15:00:41,888 - InferenceServer - INFO - Starting Server on cuda (Batch Size: 6)
2025-11-29 15:00:46,230 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:00:46,231 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 139879406229568
2025-11-29 15:00:46,465 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:00:46,467 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 139689550042624
2025-11-29 15:00:46,474 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:00:46,475 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 140508283475792
2025-11-29 15:00:46,684 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:00:46,685 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 140339971229104
2025-11-29 15:00:46,751 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:00:46,752 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 139986008674976
2025-11-29 15:00:46,851 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:00:46,853 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 140266308309712
2025-11-29 15:00:48,324 - InferenceServer - INFO - Detected compiled model (OptimizedModule). Loading weights into underlying _orig_mod.
2025-11-29 15:00:48,329 - InferenceServer - INFO - Model already compiled (or compilation unavailable), skipping re-compile.
2025-11-29 15:00:48,329 - InferenceServer - INFO - Server Ready. Listening...
2025-11-29 15:01:33,202 - game3d.game.turnmove - INFO - Move 100: WHITE KNIGHT31 [4 6 0]->[5 5 3] (Capture)
2025-11-29 15:01:37,662 - game3d.game.turnmove - INFO - Move 100: WHITE ROOK [3 3 6]->[3 3 7] (Capture)
2025-11-29 15:01:49,086 - game3d.game.turnmove - INFO - Move 100: WHITE GEOMANCER [2 3 4]->[1 6 4] (Move)
2025-11-29 15:02:00,661 - game3d.game.turnmove - INFO - Move 100: WHITE ROOK [5 3 6]->[5 3 8] (Capture)
2025-11-29 15:02:10,736 - game3d.cache.caches.movecache - INFO - Checkmate detected for BLACK (Priests: 0)
2025-11-29 15:02:10,759 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 15:02:10,759 - game3d.game.terminal - WARNING -   - White: Priests=2, King=(4,4,0)
2025-11-29 15:02:10,759 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(3,5,5)
2025-11-29 15:02:10,759 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (2,6,4), KNIGHT31 at (4,8,6)
2025-11-29 15:02:10,777 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 15:02:10,778 - game3d.game.terminal - WARNING -   - White: Priests=2, King=(4,4,0)
2025-11-29 15:02:10,778 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(3,5,5)
2025-11-29 15:02:10,779 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (2,6,4), KNIGHT31 at (4,8,6)
2025-11-29 15:02:10,810 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 15:02:10,810 - game3d.game.terminal - WARNING -   - White: Priests=2, King=(4,4,0)
2025-11-29 15:02:10,810 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(3,5,5)
2025-11-29 15:02:10,810 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (2,6,4), KNIGHT31 at (4,8,6)
2025-11-29 15:02:10,831 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 15:02:10,831 - game3d.game.terminal - WARNING -   - White: Priests=2, King=(4,4,0)
2025-11-29 15:02:10,831 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(3,5,5)
2025-11-29 15:02:10,831 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (2,6,4), KNIGHT31 at (4,8,6)
2025-11-29 15:02:10,860 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 15:02:10,860 - game3d.game.terminal - WARNING -   - White: Priests=2, King=(4,4,0)
2025-11-29 15:02:10,860 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(3,5,5)
2025-11-29 15:02:10,860 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (2,6,4), KNIGHT31 at (4,8,6)
2025-11-29 15:02:10,932 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:02:10,932 - game3d.cache.manager - DEBUG - Created cache manager #2 for board 139874421704352
2025-11-29 15:02:31,626 - game3d.game.turnmove - INFO - Move 100: WHITE XYQUEEN [4 5 1]->[3 6 1] (Move)
2025-11-29 15:02:58,312 - game3d.game.turnmove - INFO - Move 100: WHITE XYQUEEN [3 3 1]->[4 4 1] (Capture)
2025-11-29 15:03:04,105 - training.parallel_self_play - INFO - Stopping Server...
2025-11-29 15:03:04,104 - InferenceServer - INFO - Server shutting down.
2025-11-29 15:03:04,105 - game3d.game3d - CRITICAL - ðŸš¨ MOVE EXECUTION FAILED: CPUDispatcher(<function _vectorized_batch_attributes at 0x7f510a1c7e20>) returned a result with an exception set
Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 172, in _process_piece_type
    raw_moves = dispatcher(state, coord, ignore_occupancy=ignore_occupancy)
TypeError: wall_move_dispatcher() got an unexpected keyword argument 'ignore_occupancy'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3dgame/venv/lib/python3.13/site-packages/numba/core/serialize.py", line 30, in _numba_unpickle
    def _numba_unpickle(address, bytedata, hashed):
    
KeyboardInterrupt

The above exception was the direct cause of the following exception:

SystemError: <function _numba_unpickle at 0x7f510a6e2160> returned a result with an exception set

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game3d.py", line 95, in submit_move
    new_state = turnmove.make_move(self._state, move_array)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game/turnmove.py", line 341, in make_move
    gen_module._generator.update_legal_moves_incremental(game_state)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 485, in update_legal_moves_incremental
    all_moves = self._apply_all_filters(state, all_moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 358, in _apply_all_filters
    moves = filter_safe_moves_optimized(state, moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 140, in filter_safe_moves_optimized
    if move_would_leave_king_in_check(game_state, moves[i]):
       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 105, in move_would_leave_king_in_check
    is_check = square_attacked_by_incremental(
        game_state.board,
    ...<4 lines>...
        to_coord
    )
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 305, in square_attacked_by_incremental
    return _square_attacked_by_slow(board, square, attacker_color, cache)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 358, in _square_attacked_by_slow
    moves = generate_pseudolegal_moves_batch(dummy_state, attacker_positions)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 314, in generate_pseudolegal_moves_batch
    piece_moves = _process_piece_type(state, piece_type, indices, batch_coords,
                                     dispatcher, ignore_occupancy)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 175, in _process_piece_type
    raw_moves = dispatcher(state, coord)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/wall.py", line 299, in wall_move_dispatcher
    return generate_wall_moves(state.cache_manager, state.color, pos)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/wall.py", line 288, in generate_wall_moves
    colors, types = cache_manager.occupancy_cache.batch_get_attributes(flat_targets)
                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/cache/caches/occupancycache.py", line 271, in batch_get_attributes
    return _vectorized_batch_attributes(self._occ, self._ptype, coords)
SystemError: CPUDispatcher(<function _vectorized_batch_attributes at 0x7f510a1c7e20>) returned a result with an exception set
2025-11-29 15:03:04,105 - game3d.game3d - CRITICAL - ðŸš¨ MOVE EXECUTION FAILED: CPUDispatcher(<function _vectorized_batch_attributes_unsafe_parallel at 0x7fcaa41f4400>) returned a result with an exception set
Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 172, in _process_piece_type
    raw_moves = dispatcher(state, coord, ignore_occupancy=ignore_occupancy)
TypeError: infiltrator_move_dispatcher() got an unexpected keyword argument 'ignore_occupancy'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3dgame/venv/lib/python3.13/site-packages/numba/core/serialize.py", line 30, in _numba_unpickle
    def _numba_unpickle(address, bytedata, hashed):
    
KeyboardInterrupt

The above exception was the direct cause of the following exception:

SystemError: <function _numba_unpickle at 0x7fcaa46ee160> returned a result with an exception set

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game3d.py", line 95, in submit_move
    new_state = turnmove.make_move(self._state, move_array)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game/turnmove.py", line 341, in make_move
    gen_module._generator.update_legal_moves_incremental(game_state)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 485, in update_legal_moves_incremental
    all_moves = self._apply_all_filters(state, all_moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 358, in _apply_all_filters
    moves = filter_safe_moves_optimized(state, moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 140, in filter_safe_moves_optimized
    if move_would_leave_king_in_check(game_state, moves[i]):
       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 105, in move_would_leave_king_in_check
    is_check = square_attacked_by_incremental(
        game_state.board,
    ...<4 lines>...
        to_coord
    )
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 305, in square_attacked_by_incremental
    return _square_attacked_by_slow(board, square, attacker_color, cache)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 358, in _square_attacked_by_slow
    moves = generate_pseudolegal_moves_batch(dummy_state, attacker_positions)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 314, in generate_pseudolegal_moves_batch
    piece_moves = _process_piece_type(state, piece_type, indices, batch_coords,
                                     dispatcher, ignore_occupancy)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 175, in _process_piece_type
    raw_moves = dispatcher(state, coord)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/infiltrator.py", line 114, in infiltrator_move_dispatcher
    return generate_infiltrator_moves(state.cache_manager, state.color, pos)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/infiltrator.py", line 38, in generate_infiltrator_moves
    teleport_dirs = _get_pawn_front_directions(cache_manager, color, pos)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/infiltrator.py", line 77, in _get_pawn_front_directions
    _, piece_types = cache_manager.occupancy_cache.batch_get_attributes_unsafe(enemy_coords)
                     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/cache/caches/occupancycache.py", line 330, in batch_get_attributes_unsafe
    return _vectorized_batch_attributes_unsafe_parallel(self._occ, self._ptype, coords)
SystemError: CPUDispatcher(<function _vectorized_batch_attributes_unsafe_parallel at 0x7fcaa41f4400>) returned a result with an exception set
2025-11-29 15:03:04,110 - worker.4 - ERROR - Worker 4 failed: Move execution failed: CPUDispatcher(<function _vectorized_batch_attributes at 0x7f510a1c7e20>) returned a result with an exception set
Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 172, in _process_piece_type
    raw_moves = dispatcher(state, coord, ignore_occupancy=ignore_occupancy)
TypeError: wall_move_dispatcher() got an unexpected keyword argument 'ignore_occupancy'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3dgame/venv/lib/python3.13/site-packages/numba/core/serialize.py", line 30, in _numba_unpickle
    def _numba_unpickle(address, bytedata, hashed):
    
KeyboardInterrupt

The above exception was the direct cause of the following exception:

SystemError: <function _numba_unpickle at 0x7f510a6e2160> returned a result with an exception set

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game3d.py", line 95, in submit_move
    new_state = turnmove.make_move(self._state, move_array)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game/turnmove.py", line 341, in make_move
    gen_module._generator.update_legal_moves_incremental(game_state)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 485, in update_legal_moves_incremental
    all_moves = self._apply_all_filters(state, all_moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 358, in _apply_all_filters
    moves = filter_safe_moves_optimized(state, moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 140, in filter_safe_moves_optimized
    if move_would_leave_king_in_check(game_state, moves[i]):
       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 105, in move_would_leave_king_in_check
    is_check = square_attacked_by_incremental(
        game_state.board,
    ...<4 lines>...
        to_coord
    )
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 305, in square_attacked_by_incremental
    return _square_attacked_by_slow(board, square, attacker_color, cache)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 358, in _square_attacked_by_slow
    moves = generate_pseudolegal_moves_batch(dummy_state, attacker_positions)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 314, in generate_pseudolegal_moves_batch
    piece_moves = _process_piece_type(state, piece_type, indices, batch_coords,
                                     dispatcher, ignore_occupancy)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 175, in _process_piece_type
    raw_moves = dispatcher(state, coord)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/wall.py", line 299, in wall_move_dispatcher
    return generate_wall_moves(state.cache_manager, state.color, pos)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/wall.py", line 288, in generate_wall_moves
    colors, types = cache_manager.occupancy_cache.batch_get_attributes(flat_targets)
                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/cache/caches/occupancycache.py", line 271, in batch_get_attributes
    return _vectorized_batch_attributes(self._occ, self._ptype, coords)
SystemError: CPUDispatcher(<function _vectorized_batch_attributes at 0x7f510a1c7e20>) returned a result with an exception set

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/training/parallel_self_play.py", line 300, in _game_worker_client
    receipt = game.submit_move(submit_move)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game3d.py", line 98, in submit_move
    raise InvalidMoveError(f"Move execution failed: {e}") from e
game3d.game3d.InvalidMoveError: Move execution failed: CPUDispatcher(<function _vectorized_batch_attributes at 0x7f510a1c7e20>) returned a result with an exception set
2025-11-29 15:03:04,114 - worker.0 - ERROR - Worker 0 failed: Move execution failed: CPUDispatcher(<function _vectorized_batch_attributes_unsafe_parallel at 0x7fcaa41f4400>) returned a result with an exception set
Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 172, in _process_piece_type
    raw_moves = dispatcher(state, coord, ignore_occupancy=ignore_occupancy)
TypeError: infiltrator_move_dispatcher() got an unexpected keyword argument 'ignore_occupancy'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3dgame/venv/lib/python3.13/site-packages/numba/core/serialize.py", line 30, in _numba_unpickle
    def _numba_unpickle(address, bytedata, hashed):
    
KeyboardInterrupt

The above exception was the direct cause of the following exception:

SystemError: <function _numba_unpickle at 0x7fcaa46ee160> returned a result with an exception set

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game3d.py", line 95, in submit_move
    new_state = turnmove.make_move(self._state, move_array)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game/turnmove.py", line 341, in make_move
    gen_module._generator.update_legal_moves_incremental(game_state)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 485, in update_legal_moves_incremental
    all_moves = self._apply_all_filters(state, all_moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 358, in _apply_all_filters
    moves = filter_safe_moves_optimized(state, moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 140, in filter_safe_moves_optimized
    if move_would_leave_king_in_check(game_state, moves[i]):
       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 105, in move_would_leave_king_in_check
    is_check = square_attacked_by_incremental(
        game_state.board,
    ...<4 lines>...
        to_coord
    )
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 305, in square_attacked_by_incremental
    return _square_attacked_by_slow(board, square, attacker_color, cache)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 358, in _square_attacked_by_slow
    moves = generate_pseudolegal_moves_batch(dummy_state, attacker_positions)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 314, in generate_pseudolegal_moves_batch
    piece_moves = _process_piece_type(state, piece_type, indices, batch_coords,
                                     dispatcher, ignore_occupancy)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 175, in _process_piece_type
    raw_moves = dispatcher(state, coord)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/infiltrator.py", line 114, in infiltrator_move_dispatcher
    return generate_infiltrator_moves(state.cache_manager, state.color, pos)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/infiltrator.py", line 38, in generate_infiltrator_moves
    teleport_dirs = _get_pawn_front_directions(cache_manager, color, pos)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/infiltrator.py", line 77, in _get_pawn_front_directions
    _, piece_types = cache_manager.occupancy_cache.batch_get_attributes_unsafe(enemy_coords)
                     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/cache/caches/occupancycache.py", line 330, in batch_get_attributes_unsafe
    return _vectorized_batch_attributes_unsafe_parallel(self._occ, self._ptype, coords)
SystemError: CPUDispatcher(<function _vectorized_batch_attributes_unsafe_parallel at 0x7fcaa41f4400>) returned a result with an exception set

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/training/parallel_self_play.py", line 300, in _game_worker_client
    receipt = game.submit_move(submit_move)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game3d.py", line 98, in submit_move
    raise InvalidMoveError(f"Move execution failed: {e}") from e
game3d.game3d.InvalidMoveError: Move execution failed: CPUDispatcher(<function _vectorized_batch_attributes_unsafe_parallel at 0x7fcaa41f4400>) returned a result with an exception set
2025-11-29 15:03:04,129 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:03:04,129 - game3d.cache.manager - DEBUG - Created cache manager #2 for board 139981029508144
2025-11-29 15:03:04,181 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:03:04,182 - game3d.cache.manager - DEBUG - Created cache manager #2 for board 140508248827520
2025-11-29 15:03:04,340 - __main__ - INFO - Training interrupted by user
2025-11-29 15:03:04,518 - __main__ - INFO - ðŸ§¹ Clearing all caches...
2025-11-29 15:24:12,538 - __main__ - INFO - [SEARCH] Validating game system integrity...
2025-11-29 15:24:12,539 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:24:12,542 - __main__ - INFO - Testing move generation...
2025-11-29 15:24:20,889 - __main__ - INFO - [OK] Generated 648 moves
2025-11-29 15:24:20,889 - __main__ - INFO - Testing GameState caching...
2025-11-29 15:24:20,889 - __main__ - INFO - [OK] GameState caching works
2025-11-29 15:24:20,889 - __main__ - INFO - Testing MoveCache persistence...
2025-11-29 15:24:20,890 - __main__ - INFO - [OK] MoveCache works correctly
2025-11-29 15:24:20,890 - __main__ - INFO - Final cache stats: {'legal_hit_rate': np.float64(0.6666666666666666), 'pseudolegal_hit_rate': np.float64(0.0), 'raw_hit_rate': np.float64(0.0), 'piece_hit_rate': np.float64(0.0), 'total_moves_cached': np.int32(648), 'piece_moves_cache_size': 35, 'prune_operations': 0, 'cache_hits': np.int32(2), 'cache_misses': np.int32(1)}
2025-11-29 15:24:22,344 - __main__ - INFO - Saved temporary checkpoint: model_checkpoints/train_huge_20251129_152408/temp_model_for_selfplay.pt
2025-11-29 15:24:22,344 - training.parallel_self_play - INFO - Starting Client-Server Self-Play: 12 games, 6 workers
2025-11-29 15:24:25,184 - training.parallel_self_play - INFO - Launching workers...
2025-11-29 15:24:33,372 - InferenceServer - INFO - Starting Server on cuda (Batch Size: 6)
2025-11-29 15:24:37,071 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:24:37,074 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 140089625062048
2025-11-29 15:24:37,432 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:24:37,433 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 140284857619152
2025-11-29 15:24:37,887 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:24:37,888 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 140443896713312
2025-11-29 15:24:38,040 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:24:38,041 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 140573546780400
2025-11-29 15:24:38,084 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:24:38,085 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 140115436493104
2025-11-29 15:24:38,131 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:24:38,132 - game3d.cache.manager - DEBUG - Created cache manager #1 for board 139909804463088
2025-11-29 15:24:38,714 - InferenceServer - INFO - Detected compiled model (OptimizedModule). Loading weights into underlying _orig_mod.
2025-11-29 15:24:38,718 - InferenceServer - INFO - Model already compiled (or compilation unavailable), skipping re-compile.
2025-11-29 15:24:38,718 - InferenceServer - INFO - Server Ready. Listening...
2025-11-29 15:25:15,130 - game3d.game.turnmove - INFO - Move 100: WHITE PANEL [4 4 2]->[4 4 7] (Capture)
2025-11-29 15:25:45,105 - game3d.cache.caches.movecache - INFO - Checkmate detected for WHITE (Priests: 0)
2025-11-29 15:25:45,120 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: BLACK)
2025-11-29 15:25:45,120 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 15:25:45,120 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,3,8)
2025-11-29 15:25:45,120 - game3d.game.terminal - WARNING -   - Attackers: CONESLIDER at (0,0,3)
2025-11-29 15:25:45,140 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: BLACK)
2025-11-29 15:25:45,140 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 15:25:45,141 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,3,8)
2025-11-29 15:25:45,141 - game3d.game.terminal - WARNING -   - Attackers: CONESLIDER at (0,0,3)
2025-11-29 15:25:45,174 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: BLACK)
2025-11-29 15:25:45,175 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 15:25:45,175 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,3,8)
2025-11-29 15:25:45,175 - game3d.game.terminal - WARNING -   - Attackers: CONESLIDER at (0,0,3)
2025-11-29 15:25:45,201 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: BLACK)
2025-11-29 15:25:45,201 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 15:25:45,201 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,3,8)
2025-11-29 15:25:45,201 - game3d.game.terminal - WARNING -   - Attackers: CONESLIDER at (0,0,3)
2025-11-29 15:25:45,235 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: BLACK)
2025-11-29 15:25:45,235 - game3d.game.terminal - WARNING -   - White: Priests=0, King=(4,4,0)
2025-11-29 15:25:45,235 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(4,3,8)
2025-11-29 15:25:45,235 - game3d.game.terminal - WARNING -   - Attackers: CONESLIDER at (0,0,3)
2025-11-29 15:25:45,283 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:25:45,283 - game3d.cache.manager - DEBUG - Created cache manager #2 for board 140438161619360
2025-11-29 15:25:49,161 - game3d.cache.caches.movecache - INFO - Checkmate detected for BLACK (Priests: 0)
2025-11-29 15:25:49,182 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 15:25:49,182 - game3d.game.terminal - WARNING -   - White: Priests=1, King=(4,4,0)
2025-11-29 15:25:49,182 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(3,4,7)
2025-11-29 15:25:49,182 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,7), PANEL at (4,4,7)
2025-11-29 15:25:49,205 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 15:25:49,205 - game3d.game.terminal - WARNING -   - White: Priests=1, King=(4,4,0)
2025-11-29 15:25:49,205 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(3,4,7)
2025-11-29 15:25:49,205 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,7), PANEL at (4,4,7)
2025-11-29 15:25:49,238 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 15:25:49,238 - game3d.game.terminal - WARNING -   - White: Priests=1, King=(4,4,0)
2025-11-29 15:25:49,238 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(3,4,7)
2025-11-29 15:25:49,238 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,7), PANEL at (4,4,7)
2025-11-29 15:25:49,256 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 15:25:49,257 - game3d.game.terminal - WARNING -   - White: Priests=1, King=(4,4,0)
2025-11-29 15:25:49,257 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(3,4,7)
2025-11-29 15:25:49,257 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,7), PANEL at (4,4,7)
2025-11-29 15:25:49,292 - game3d.game.terminal - WARNING - Game over: Checkmate (Winner: WHITE)
2025-11-29 15:25:49,292 - game3d.game.terminal - WARNING -   - White: Priests=1, King=(4,4,0)
2025-11-29 15:25:49,292 - game3d.game.terminal - WARNING -   - Black: Priests=0, King=(3,4,7)
2025-11-29 15:25:49,292 - game3d.game.terminal - WARNING -   - Attackers: PANEL at (4,4,7), PANEL at (4,4,7)
2025-11-29 15:25:49,373 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:25:49,373 - game3d.cache.manager - DEBUG - Created cache manager #2 for board 140084640430832
2025-11-29 15:26:01,321 - game3d.game.turnmove - INFO - Move 100: WHITE CONESLIDER [3 5 5]->[3 4 6] (Capture)
2025-11-29 15:26:04,042 - training.parallel_self_play - INFO - Stopping Server...
2025-11-29 15:26:04,044 - InferenceServer - INFO - Server shutting down.
2025-11-29 15:26:04,044 - game3d.game3d - CRITICAL - ðŸš¨ MOVE EXECUTION FAILED: CPUDispatcher(<function _vectorized_batch_attributes at 0x7fd9d61c7e20>) returned a result with an exception set
Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 172, in _process_piece_type
    raw_moves = dispatcher(state, coord, ignore_occupancy=ignore_occupancy)
TypeError: wall_move_dispatcher() got an unexpected keyword argument 'ignore_occupancy'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3dgame/venv/lib/python3.13/site-packages/numba/core/serialize.py", line 30, in _numba_unpickle
    def _numba_unpickle(address, bytedata, hashed):
    
KeyboardInterrupt

The above exception was the direct cause of the following exception:

SystemError: <function _numba_unpickle at 0x7fd9d66e2160> returned a result with an exception set

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game3d.py", line 95, in submit_move
    new_state = turnmove.make_move(self._state, move_array)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game/turnmove.py", line 341, in make_move
    gen_module._generator.update_legal_moves_incremental(game_state)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 485, in update_legal_moves_incremental
    all_moves = self._apply_all_filters(state, all_moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 358, in _apply_all_filters
    moves = filter_safe_moves_optimized(state, moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 140, in filter_safe_moves_optimized
    if move_would_leave_king_in_check(game_state, moves[i]):
       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 105, in move_would_leave_king_in_check
    is_check = square_attacked_by_incremental(
        game_state.board,
    ...<4 lines>...
        to_coord
    )
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 305, in square_attacked_by_incremental
    return _square_attacked_by_slow(board, square, attacker_color, cache)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 358, in _square_attacked_by_slow
    moves = generate_pseudolegal_moves_batch(dummy_state, attacker_positions)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 314, in generate_pseudolegal_moves_batch
    piece_moves = _process_piece_type(state, piece_type, indices, batch_coords,
                                     dispatcher, ignore_occupancy)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 175, in _process_piece_type
    raw_moves = dispatcher(state, coord)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/wall.py", line 299, in wall_move_dispatcher
    return generate_wall_moves(state.cache_manager, state.color, pos)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/wall.py", line 288, in generate_wall_moves
    colors, types = cache_manager.occupancy_cache.batch_get_attributes(flat_targets)
                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/cache/caches/occupancycache.py", line 271, in batch_get_attributes
    return _vectorized_batch_attributes(self._occ, self._ptype, coords)
SystemError: CPUDispatcher(<function _vectorized_batch_attributes at 0x7fd9d61c7e20>) returned a result with an exception set
2025-11-29 15:26:04,048 - worker.4 - ERROR - Worker 4 failed: Move execution failed: CPUDispatcher(<function _vectorized_batch_attributes at 0x7fd9d61c7e20>) returned a result with an exception set
Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 172, in _process_piece_type
    raw_moves = dispatcher(state, coord, ignore_occupancy=ignore_occupancy)
TypeError: wall_move_dispatcher() got an unexpected keyword argument 'ignore_occupancy'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3dgame/venv/lib/python3.13/site-packages/numba/core/serialize.py", line 30, in _numba_unpickle
    def _numba_unpickle(address, bytedata, hashed):
    
KeyboardInterrupt

The above exception was the direct cause of the following exception:

SystemError: <function _numba_unpickle at 0x7fd9d66e2160> returned a result with an exception set

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game3d.py", line 95, in submit_move
    new_state = turnmove.make_move(self._state, move_array)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game/turnmove.py", line 341, in make_move
    gen_module._generator.update_legal_moves_incremental(game_state)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 485, in update_legal_moves_incremental
    all_moves = self._apply_all_filters(state, all_moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 358, in _apply_all_filters
    moves = filter_safe_moves_optimized(state, moves)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/generator.py", line 140, in filter_safe_moves_optimized
    if move_would_leave_king_in_check(game_state, moves[i]):
       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 105, in move_would_leave_king_in_check
    is_check = square_attacked_by_incremental(
        game_state.board,
    ...<4 lines>...
        to_coord
    )
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 305, in square_attacked_by_incremental
    return _square_attacked_by_slow(board, square, attacker_color, cache)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/attacks/check.py", line 358, in _square_attacked_by_slow
    moves = generate_pseudolegal_moves_batch(dummy_state, attacker_positions)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 314, in generate_pseudolegal_moves_batch
    piece_moves = _process_piece_type(state, piece_type, indices, batch_coords,
                                     dispatcher, ignore_occupancy)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/movement/pseudolegal.py", line 175, in _process_piece_type
    raw_moves = dispatcher(state, coord)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/wall.py", line 299, in wall_move_dispatcher
    return generate_wall_moves(state.cache_manager, state.color, pos)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/pieces/pieces/wall.py", line 288, in generate_wall_moves
    colors, types = cache_manager.occupancy_cache.batch_get_attributes(flat_targets)
                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/cache/caches/occupancycache.py", line 271, in batch_get_attributes
    return _vectorized_batch_attributes(self._occ, self._ptype, coords)
SystemError: CPUDispatcher(<function _vectorized_batch_attributes at 0x7fd9d61c7e20>) returned a result with an exception set

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/training/parallel_self_play.py", line 300, in _game_worker_client
    receipt = game.submit_move(submit_move)
  File "/home/salamimommy/Documents/code/3d-chess-for-AI/game3d/game3d.py", line 98, in submit_move
    raise InvalidMoveError(f"Move execution failed: {e}") from e
game3d.game3d.InvalidMoveError: Move execution failed: CPUDispatcher(<function _vectorized_batch_attributes at 0x7fd9d61c7e20>) returned a result with an exception set
2025-11-29 15:26:04,061 - game3d.cache.manager - INFO - Initialized occupancy cache from board setup: 486 pieces
2025-11-29 15:26:04,061 - game3d.cache.manager - DEBUG - Created cache manager #2 for board 140568545825680
2025-11-29 15:26:04,397 - __main__ - INFO - Training interrupted by user
2025-11-29 15:26:04,657 - __main__ - INFO - ðŸ§¹ Clearing all caches...
